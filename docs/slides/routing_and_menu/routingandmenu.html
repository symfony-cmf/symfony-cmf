<!DOCTYPE html>
<html>
    <head>

        <!-- To render these slides you need Slippy https://github.com/Seldaek/slippy -->

        <title>Symfony2 CMF - Routing and Navigation Menu</title>

        <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />

        <meta name="author" content="Symfony CMF" />
        <meta name="email" content="Symfony2 CMF-devs@googlegroups.com" />
        <meta name="date" content="2012-01-11" />
        <meta name="venue" content="The Internets" />

        <!-- Slippy core file and dependencies -->
        <script type="text/javascript" src="jquery.min.js"></script>
        <script type="text/javascript" src="jquery.history.js"></script>
        <script type="text/javascript" src="slippy.js"></script>
        <!-- Slippy structural styles -->
        <link type="text/css" rel="stylesheet" href="slippy.css"/>
        <!-- Slippy theme -->
        <link type="text/css" rel="stylesheet" href="slippy-pure.css"/>
        <!-- Syntax highlighting core file  -->
        <script type="text/javascript" src="highlighter/shCore.js"></script>
        <!-- Syntax highlighting brushes, remove those you don't need -->
        <script type="text/javascript" src="highlighter/shBrushPhp.js"></script>
        <script type="text/javascript" src="highlighter/shBrushPlain.js"></script>
        <script type="text/javascript" src="highlighter/shBrushXml.js"></script>
        <!-- Syntax highlighting styles-->
        <link type="text/css" rel="stylesheet" href="highlighter/shCore.css"/>
        <link type="text/css" rel="stylesheet" href="highlighter/shThemeEclipse.css"/>

        <style type="text/css">
            body > * {
                font-size: 1.2em;
            }

            body {
                background: #fff;
                line-height: 2em;
            }

            div.syntaxhighlighter {
                background: #aaa !important;
            }

            span.file {
                font-size: 0.8em;
                color: #f00;
                float: right;
                margin: -.2em .5em 0 0;
            }

            .smallcode {
                font-size: 0.8em;
            }

            strong {
                color: #662222;
            }

        </style>
        <!-- Slippy init code -->
        <script type="text/javascript">
            $(function() {
                $(".slide").slippy({
                    animLen: 0,
                    baseWidth: false,
                    ratio: 1.6
                });
                SyntaxHighlighter.all();
            });
        </script>
    </head>

    <body>
        <div class="slide" style="text-align:center">
            <h2>Symfony2 CMF Project</h2>
            <h1>Routing and navigation menu components</h1>
            <h3><a href="http://cmf.symfony.com">cmf.symfony.com</a></h3>
            <p style="font-style: italic; margin-top: 30px;">An introduction to the routing and menu components.</p>
        </div>

        <div class="slide" style="text-align:left">
            <h2>
                Symfony2 routing
            </h2>
            <ul>
                <li>determine controller to handle this request</li>
                <li>parse url parameters</li>
                <li>
                    default: based on configured set of routes
                    <ul>
                        <li>loaded from configuration files</li>
                        <li>generated by bundles</li>
                    </ul>
                </li>
                <li>does not support dynamic routes</li>
                <li>does not scale to a large number of routes</li>
                <li>in a cms, the <em>user</em> wants to define their urls</li>
            </ul>
        </div>

        <div class="slide" style="text-align:left">
            <h2>
                Symfony2 CMF routing concept
            </h2>
            <ul>
                <li>optionally separate content tree from navigation tree</li>
                <li>navigation tree consists of references to the content tree</li>
                <li>
                    <ul>
                        <li>multi site: f.e. desktop, tablet, phone ..</li>
                        <li>multi language: f.e. english, french, german ..</li>
                    </ul>
                </li>
                <li>reworking the navigation requires cloning the navigation tree</li>
                <li>merge back into the production navigation tree once ready</li>
            </ul>
        </div>

        <div class="slide" style="text-align:left">
            <h2>Solution: First Take</h2>
            <ul>
                <li>catch-all route <tt>/{url}</tt> with requirement <tt>url: .*</tt></li>
                <li>one controller for all requests (but could forward based on content)</li>
                <li>does not play nicely with other routes</li>
            </ul>
            <br/><br/>
            <pre class="brush: text">
            navigation:
                pattern: "/{url}"
                defaults: { _controller: service.controller:indexAction }
                requirements:
                    url: .*
            </pre>
        </div>


        <div class="slide" style="text-align:left">
            <h2>Solution: Better</h2>
            <ul>
                <li>Custom router
                    <ul>
                        <li>full flexibility</li>
                        <li>lookup in database</li>
                    </ul>
                </li>
                <li>Chain router
                    <ul>
                        <li>to combine both routing concepts</li>
                        <li>and along the way allow you to add your own routers</li>
                    </ul>
                </li>
            </ul>
        </div>

        <div class="slide" style="text-align:left">
            <h2>Chain Router</h2>
            <ul>
                <li>find router services by tagging</li>
                <li>tries to match with each configured router</li>
                <li>with priorities to control order</li>
                <li>fully production-ready and complete</li>
            </ul>
            <br/><br/>
            <pre class="brush: xml">
                <service id="my_namespace.my_router"
                         class="%my_namespace.my_router_class%">
                    <tag name="router" priority="300" />
                </service>
            </pre>
        </div>

        <div class="slide" style="text-align:left">
            <h2>Doctrine Router: Match url</h2>
            <ul>
                <li>find route document by url from database
                    <ul>
                        <li>provide implementation with PHPCR ODM</li>
                        <li>but you can provide your own</li>
                    </ul>
                </li>
                <li>route may explicitly specify controller</li>
                <li>otherwise a controller resolver is used</li>
                <li>redirection route (to other route or absolute url)</li>
            </ul>
        </div>

        <div class="slide" style="text-align:left">
            <h2>Doctrine Router: Controller Resolvers</h2>
            <ul>
                <li>find out which controller handles given content node</li>
                <li>useful resolvers provided:</li>
                    <ul>
                        <li>route specifies explicit template: use generic controller</li>
                        <li>map content type to controller</li>
                        <li>map content type to template and use generic controller</li>
                    </ul>
                </li>
                <li>you can add your own resolvers</li>
            </ul>
            <br/><br/>
            <pre class="brush: php">
                interface ControllerResolverInterface
                {
                    function getController(RouteObjectInterface $document,
                                           array &$defaults);
                }
            </pre>
        </div>

        <div class="slide" style="text-align:center">
            <h2>Routing and Content</h2>
            <br/>
            <p><img src="routing.png"/></p>
        </div>

        <div class="slide" style="text-align:left">
            <h2>Doctrine Router: Generate</h2>
            <ul>
                <li>generate url from content being referenced by route</li>
            </ul>
        </div>

        <div class="slide" style="text-align:left">
            <h2>Menu</h2>
            <ul>
                <li>provide NodeInterface with PHPCR ODM documents</li>
                <li>menu renderer: if MenuItem specifies content
                    <ul>
                        <li>generate route from content</li>
                        <li>determine active menu item from content in request</li>
                    </ul>
                </li>
                <li>otherwise let standard menu renderer handle this entry</li>
                <li>with PHPCR ODM, multi language menus are a breeze
                    <ul>
                        <li>see MultilangMenuItem in Symfony2 CMF in the MultilangContentBundle</li>
                    </ul>
                </li>
            </ul>
            <br/>
            <img src="menubundle.png"/>
        </div>

        <div class="slide" style="text-align:center">
            <h2>Routing and Content and Menu</h2>
            <br/>
            <p><img src="routing_and_menu.png"/></p>
        </div>

        <div class="slide" style="text-align:left">
            <h2>Outlook</h2>
            <ul>
            <li>doctrine router works but further improvements are ongoing
                <ul>
                    <li>implement url parameters (<a href="https://github.com/symfony-cmf/ChainRoutingBundle/issues/8">github</a>)</li>
                    <li>and add _locale support</li>
                    <li>decide on getRouteCollection (<a href="https://github.com/symfony-cmf/ChainRoutingBundle/issues/9">github</a>)</li>
                </ul>
            </li>
            <li>pimp KnpMenu with breadcrumb twig function (<a href="https://github.com/KnpLabs/KnpMenu/issues/24">github</a>)</li>
            </ul>
        </div>


        <div class="slide" style="text-align:left">
            <h2>Conclusions</h2>
            <ul>
                <li>very flexible way to handle things</li>
                <li>ready for simple projects</li>
                <li>only missing url parameters to be fully ready</li>
                <li>if you don't need the flexibility, just make menu, route and content the same class :-)</li>
            </ul>
        </div>

        <div class="slide">
            <h2>Github projects</h2>
            <ul>
                <li><a href="https://github.com/symfony-cmf/cmf-sandbox">CMF sandbox</a></li>
                <li><a href="https://github.com/symfony-cmf/symfony-cmf">Core Components</a> including SymfonyCmfMenuBundle</li>
                <li><a href="https://github.com/symfony-cmf/ChainRoutingBundle">Chain Routing and Doctrine Routing</a></li>
            </ul>
        </div>

        <div class="slide">
            <h2>Resources</h2>
            <ul>
                <li><a href="irc://freenode/#symfony-cmf">#symfony-cmf IRC</a></li>
                <li><a href="http://groups.google.com/group/symfony-cmf-devs">Mailinglist devs</a> | <a href="http://groups.google.com/group/symfony-cmf-users">users</a></li>
                <li><a href="http://cmf.symfony.com">http://cmf.symfony.com</a></li>
                <li><a href="https://github.com/symfony-cmf/symfony-cmf/wiki">Symfony CMF wiki</a></li>
            </ul>
        </div>

        <div class="footer">
            <span class="right"><a href="irc://freenode/#symfony-cmf">#symfony-cmf IRC</a></span>
            <span class="left"><a href="http://cmf.symfony.com">cmf.symfony.com</a></span>
            <hr class="defloat" />
        </div>

    </body>
</html>
