<!DOCTYPE html>
<html>
    <head>

        <!-- To render these slides you need Slippy https://github.com/Seldaek/slippy -->

        <title>Symfony2 CMF - Routing and Navigation Menu</title>

        <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />

        <meta name="author" content="Symfony2 CMF" />
        <meta name="email" content="symfony-cmf-devs@googlegroups.com" />
        <meta name="date" content="2012-01-11" />
        <meta name="venue" content="The Internets" />

        <!-- Slippy core file and dependencies -->
        <script type="text/javascript" src="jquery.min.js"></script>
        <script type="text/javascript" src="jquery.history.js"></script>
        <script type="text/javascript" src="slippy.js"></script>
        <!-- Slippy structural styles -->
        <link type="text/css" rel="stylesheet" href="slippy.css"/>
        <!-- Slippy theme -->
        <link type="text/css" rel="stylesheet" href="slippy-pure.css"/>
        <!-- Syntax highlighting core file  -->
        <script type="text/javascript" src="highlighter/shCore.js"></script>
        <!-- Syntax highlighting brushes, remove those you don't need -->
        <script type="text/javascript" src="highlighter/shBrushPhp.js"></script>
        <script type="text/javascript" src="highlighter/shBrushPlain.js"></script>
        <script type="text/javascript" src="highlighter/shBrushXml.js"></script>
        <!-- Syntax highlighting styles-->
        <link type="text/css" rel="stylesheet" href="highlighter/shCore.css"/>
        <link type="text/css" rel="stylesheet" href="highlighter/shThemeEclipse.css"/>

        <style type="text/css">
            body > * {
                font-size: 1.2em;
            }

            body {
                background: #fff;
                line-height: 2em;
            }

            div.syntaxhighlighter {
                background: #aaa !important;
            }

            span.file {
                font-size: 0.8em;
                color: #f00;
                float: right;
                margin: -.2em .5em 0 0;
            }

            .smallcode {
                font-size: 0.8em;
            }

            strong {
                color: #662222;
            }

        </style>
        <!-- Slippy init code -->
        <script type="text/javascript">
            $(function() {
                $(".slide").slippy({
                    animLen: 0,
                    baseWidth: false,
                    ratio: 1.6
                });
                SyntaxHighlighter.all();
            });
        </script>
    </head>

    <body>
        <div class="slide" style="text-align:center">
            <h2>Symfony2 CMF Project</h2>
            <h1>Routing and navigation menu components</h1>
            <h3><a href="http://cmf.symfony.com">cmf.symfony.com</a></h3>
            <p style="font-style: italic; margin-top: 30px;">An introduction to the routing and menu components.</p>
        </div>

        <div class="slide" style="text-align:left">
            <h2>
                Symfony2 routing
            </h2>
            <ul>
                <li>determine controller to handle this request</li>
                <li>parse url parameters</li>
                <li>
                    default: based on configured set of routes
                    <ul>
                        <li>loaded from configuration files</li>
                        <li>generated by bundles</li>
                    </ul>
                </li>
                <li>does not support editing routes</li>
                <li>large number of routes?</li>
                <li>in a cms, <em>users</em> wants to define their urls</li>
            </ul>
        </div>

        <div class="slide" style="text-align:left">
            <h2>
                Symfony2 CMF routing concept
            </h2>
            <ul>
                <li>load routes at runtime based on current request</li>
                <li>simple interface for route loading can be implemented with your storage</li>
                <li>possible to separate content tree from routing tree</li>
                <li>
                    routing tree consists of references to the content tree
                    <ul>
                        <li>multi site: f.e. desktop, tablet, phone ..</li>
                        <li>multi language: f.e. english, french, german ..</li>
                    </ul>
                </li>
                <li>reworking the routing requires cloning the routing tree</li>
                <li>merge back into the production routing tree once ready</li>
            </ul>
        </div>

        <div class="slide" style="text-align:left">
            <h2>Solution: First Take</h2>
            <ul>
                <li>catch-all route <tt>/{url}</tt> with requirement <tt>url: .*</tt></li>
                <li>one controller for all requests (but could forward based on route information)</li>
                <li>two-step-routing tends to reinventing the wheel and creating a mess</li>
                <li>does not play nicely with other routes</li>
            </ul>
            <br/><br/>
            <pre class="brush: text">
            navigation:
                pattern: "/{url}"
                defaults: { _controller: service.controller:indexAction }
                requirements:
                    url: .*
            </pre>
        </div>


        <div class="slide" style="text-align:left">
            <h2>Solution: Cmf Routing component</h2>
            <ul>
                <li>The new DynamicRouter
                    <ul>
                        <li>full flexibility</li>
                        <li>lookup in database</li>
                    </ul>
                </li>
                <li>ChainRouter
                    <ul>
                        <li>to combine both routing concepts</li>
                        <li>and along the way allow you to add your own routers</li>
                    </ul>
                </li>
            </ul>
        </div>

        <div class="slide" style="text-align:left">
            <h2>ChainRouter</h2>
            <ul>
                <li>find router services by tagging</li>
                <li>tries to match with each configured router</li>
                <li>with priorities to control order</li>
            </ul>
            <br/><br/>
            <pre class="brush: xml">
                <service id="my_namespace.my_router"
                         class="%my_namespace.my_router_class%">
                    <tag name="router" priority="300" />
                </service>
            </pre>
        </div>

        <div class="slide" style="text-align:left">
            <h2>DynamicRouter: Match url</h2>
            <ul>
                <li>find route document by url from database
                    <ul>
                        <li>provide implementation with PHPCR ODM</li>
                        <li>but you can provide your own</li>
                    </ul>
                </li>
                <li>built on top of the standard symfony router</li>
                <li>route may explicitly specify controller</li>
                <li>otherwise enhancers to determine values</li>
                <li>redirection route (to other route or absolute url)</li>
            </ul>
        </div>

        <div class="slide" style="text-align:left">
            <h2>DynamicRouter: Route Enhancers</h2>
            <ul>
                <li>infer some information from the route information</li>
                <li>i.e. decide which controller to use based on content document type</li>
                <li>useful enhancers provided:</li>
                    <ul>
                        <li>route specifies explicit template: use generic controller</li>
                        <li>map content type to controller</li>
                        <li>map content type to template and use generic controller</li>
                    </ul>
                </li>
                <li>you can add your own enhancers</li>
            </ul>
            <br/><br/>
            <pre class="brush: php">
                interface ControllerEnhancerInterface
                {
                    public function enhance(array $defaults, Request $request);
                }
            </pre>
        </div>

        <div class="slide" style="text-align:center">
            <h2>Routing and Content</h2>
            <br/>
            <p><img src="routing.png"/></p>
        </div>

        <div class="slide" style="text-align:left">
            <h2>DynamicRouter: Generate url from referenced content</h2>
            <pre class="brush: php">
                $this->router->generate($content);
            </pre>
            <ul>
                <li>DynamicRouter can generate url from content document, route document as well as content or route repository id</li>
            </ul>
        </div>

        <div class="slide" style="text-align:left">
            <h2>Menu</h2>
            <ul>
                <li>provide <tt>Knp\Menu\NodeInterface</tt> with PHPCR ODM documents</li>
                <li>menu renderer: if MenuItem specifies content
                    <ul>
                        <li>generate route from content</li>
                        <li>determine active menu item from content in request</li>
                    </ul>
                </li>
                <li>otherwise let standard menu renderer handle this entry</li>
                <li>with PHPCR ODM, multi language menus are a breeze</li>
            </ul>
            <br/>
            <img src="menubundle.png"/>
        </div>

        <div class="slide" style="text-align:center">
            <h2>Routing and Content and Menu</h2>
            <br/>
            <p><img src="routing_and_menu.png"/></p>
        </div>

        <div class="slide" style="text-align:left">
            <h2>Conclusions</h2>
            <ul>
                <li>very flexible way to handle things</li>
                <li>building on top of the symfony router</li>
                <li>routing parameters, locale support</li>
                <li>ready to use standalone or with other Symfony CMF components</li>
                <li>if you don't need the flexibility, just make menu, route and content the same class :-)
                    [ As demonstrated in the SimpleCmsBundle ]
                </li>
            </ul>
        </div>

        <div class="slide">
            <h2>Github projects</h2>
            <ul>
                <li><a href="https://github.com/symfony-cmf/cmf-sandbox">CMF sandbox</a></li>
                <li><a href="https://github.com/symfony-cmf/MenuBundle/">MenuBundle</a></li>
                <li><a href="https://github.com/symfony-cmf/RoutingBundle">RoutingBundle</a>: ChainRouter and DynamicRouter</li>
            </ul>
        </div>

        <div class="slide">
            <h2>Resources</h2>
            <ul>
                <li><a href="irc://freenode/#symfony-cmf">#symfony-cmf IRC</a></li>
                <li><a href="http://groups.google.com/group/symfony-cmf-devs">Mailinglist devs</a> | <a href="http://groups.google.com/group/symfony-cmf-users">users</a></li>
                <li><a href="http://cmf.symfony.com">http://cmf.symfony.com</a></li>
                <li><a href="https://github.com/symfony-cmf/symfony-cmf/wiki">Symfony CMF wiki</a></li>
            </ul>
        </div>

        <div class="footer">
            <span class="right"><a href="irc://freenode/#symfony-cmf">#symfony-cmf IRC</a></span>
            <span class="left"><a href="http://cmf.symfony.com">cmf.symfony.com</a></span>
            <hr class="defloat" />
        </div>

    </body>
</html>
